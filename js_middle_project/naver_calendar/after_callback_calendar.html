<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Callback</title>
</head>
<body>
    <h1>Calendar</h1>
    <div id="calendar"></div>


    <script src='https://cdnjs.cloudflare.com/ajax/libs/axios/1.1.3/axios.min.js'></script>
    <script>
        window.onload = async function() {
            // URL에서 code를 추출
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            console.log(code);
            if (code) {
                const clientId = '클라이언트ID';
                const clientSecret = '클라이언트시크릿키';   //github에 올리기떄문에 삭제합니다.
                try {
                    const url = `https://nid.naver.com/oauth2.0/token?grant_type=authorization_code&client_id=${clientId}&client_secret=${clientSecret}&code=${code}`;
                    const proxyUrl = `https://cors-anywhere.herokuapp.com/${url}`;

                    const tokenResponse = await fetch(proxyUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                    });

                    const tokenData = await tokenResponse.text();
                    console.log(tokenData);

                    // 액세스 토큰을 파싱하여 JSON 형식으로 변환
                    const tokenJson = JSON.parse(tokenData);
                    const accessToken = tokenJson.access_token;

                
                    const calendarUrl = `https://openapi.naver.com/calendar/createSchedule.json`;  //이건 herokuapp 말고 spring 서버로해서 java예제코드를 해야겠네.


                    const calendarProxyUrl = `http://localhost:8080/createSchedule?token=${accessToken}`;
                    const apiResponse = await fetch(calendarProxyUrl);
                    console.log(apiResponse);
                    //서버에서 보내는 데이터는 String이니까...

                    const apiData = await apiResponse.json();
                    console.log('Calendar List:', apiData);

                    document.getElementById('calendar').innerHTML = JSON.stringify(apiData, null, 2);
                } catch (error) {
                    console.error('Error:', error);
                }
            }
        };
    </script>
</body>
</html>
